<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏û‡∏±‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- Global Styles --- */
        :root { --primary: #5D4037; --secondary: #8D6E63; --bg: #FDF5E6; --white: #ffffff; --accent: #A1887F; --red: #C62828; --green: #2E7D32; }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #4E342E; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Inputs & Buttons */
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #D7CCC8; border-radius: 6px; box-sizing: border-box; margin-bottom: 8px; font-family: 'Sarabun'; }
        .action-btn { background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .action-btn:hover { opacity: 0.9; }
        .delete-btn { background: #FFEBEE; color: var(--red); border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .edit-btn { background: #E3F2FD; color: #1565C0; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px; }

        /* Layout Components */
        .auth-bar { background: rgba(255,255,255,0.95); padding: 15px; border-radius: 12px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
        .hidden { display: none !important; }
        
        /* Grid Layouts */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .menu-card { background: white; padding: 30px; border-radius: 15px; text-align: center; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .menu-card:hover { transform: translateY(-5px); border: 2px solid var(--primary); }
        .menu-card i { font-size: 3em; color: var(--primary); margin-bottom: 10px; }

        /* POS Styles */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
        .product-item { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; position: relative; }
        .product-img { width: 100%; height: 100px; object-fit: cover; background: #eee; }
        .product-info { padding: 8px; text-align: center; font-size: 0.9em; }
        .stock-badge { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7em; }

        /* Table Styles */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        th { background: #EFEBE9; padding: 10px; text-align: left; }
        td { border-bottom: 1px solid #eee; padding: 10px; }

        /* Bill Paper Styles */
        .modal { display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow-y: auto; }
        .modal-content { background: white; margin: 2% auto; padding: 20px; width: 90%; max-width: 450px; border-radius: 8px; position: relative; }
        
        #printableArea { font-family: 'Sarabun', sans-serif; color: black; padding: 10px; }
        .bill-header { text-align: center; margin-bottom: 15px; border-bottom: 1px dashed #000; padding-bottom: 10px; }
        .bill-logo { width: 80px; height: auto; display: block; margin: 0 auto 10px auto; }
        .bill-title { font-size: 1.2em; font-weight: bold; margin: 5px 0; }
        .bill-table { width: 100%; font-size: 0.85em; border-collapse: collapse; }
        .bill-table th { border-bottom: 1px solid #000; text-align: right; background: #fff; padding: 4px; }
        .bill-table th:first-child { text-align: left; }
        .bill-table td { border-bottom: 1px dotted #ccc; text-align: right; padding: 4px; }
        .bill-table td:first-child { text-align: left; }
        
        /* Simple Bill Mode (Hide detailed info) */
        .simple-mode .detailed-info { display: none; }

        @media print {
            body * { visibility: hidden; }
            #printableArea, #printableArea * { visibility: visible; }
            #printableArea { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>

<div id="login-section" style="height: 90vh; display: flex; align-items: center; justify-content: center;">
    <div class="card" style="text-align: center; width: 100%; max-width: 350px;">
        <img src="‡∏û‡∏±‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á.png" style="width: 100px; margin-bottom: 10px;" onerror="this.src='https://via.placeholder.com/100'">
        <h2 style="color:var(--primary);">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
        <button onclick="loginWithGoogle()" class="action-btn" style="width:100%; background:#4285F4;"><i class="fab fa-google"></i> Login with Google</button>
    </div>
</div>

<div id="app-section" class="container hidden">
    <div class="auth-bar">
        <div style="display: flex; align-items: center; gap: 10px;">
            <img id="userImg" src="" style="width:35px; height:35px; border-radius:50%;">
            <div>
                <div id="userName" style="font-weight:bold;">User</div>
                <div id="roleBadge" style="font-size:0.8em; color:var(--red); display:none;">Admin</div>
            </div>
        </div>
        <div>
            <button onclick="goHome()" class="action-btn" style="background:var(--secondary);">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <button onclick="logout()" class="delete-btn">‡∏≠‡∏≠‡∏Å</button>
        </div>
    </div>

    <div id="dashboard-view">
        <div class="dashboard-grid">
            <div class="menu-card" onclick="openSystem('pos')">
                <i class="fas fa-cash-register"></i>
                <h3>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≤‡∏¢ (POS)</h3>
                <p>‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•</p>
            </div>
            <div class="menu-card" onclick="openSystem('stock')">
                <i class="fas fa-boxes"></i>
                <h3>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ & ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å (Raw & Sale)</p>
            </div>
            <div class="menu-card" onclick="openSystem('cost')">
                <i class="fas fa-calculator"></i>
                <h3>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h3>
                <p>‡∏Ñ‡∏¥‡∏î‡∏™‡∏π‡∏ï‡∏£ / ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Standalone)</p>
            </div>
        </div>
        <div style="text-align:center; margin-top:20px;">
            <button id="btnShopSet" onclick="openShopSettings()" class="action-btn hidden" style="background:var(--accent);">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÉ‡∏ô‡∏ö‡∏¥‡∏•)</button>
        </div>
    </div>

    <div id="pos-view" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h2 style="margin:0;">üõí ‡∏Ç‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</h2>
            <button id="btnSalesHistory" onclick="openSalesHistory()" class="action-btn hidden" style="background:var(--accent); font-size:0.9em;"><i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (Admin)</button>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
            <div id="posGrid" class="product-grid">Loading Products...</div>
            
            <div class="card" style="height:fit-content;">
                <h3 style="margin-top:0;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h3>
                <div id="cartList" style="min-height:150px; max-height:400px; overflow-y:auto;">
                    <p style="text-align:center; color:#ccc;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
                </div>
                <div style="text-align:right; font-size:1.5em; font-weight:bold; color:var(--primary); margin:15px 0;">
                    ‡∏£‡∏ß‡∏°: <span id="cartTotal">0.00</span>
                </div>
                
                <p style="font-size:0.8em; color:#666; margin-bottom:5px;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏¥‡∏•:</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <button onclick="checkout('simple')" class="action-btn" style="background:var(--green);"><i class="fas fa-receipt"></i> ‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
                    <button onclick="checkout('full')" class="action-btn" style="background:#1565C0;"><i class="fas fa-file-invoice"></i> ‡∏ö‡∏¥‡∏•‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ</button>
                </div>
                <button onclick="checkout('quote')" class="action-btn" style="width:100%; margin-top:10px; background:var(--secondary);">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</button>
                <button onclick="clearCart()" class="delete-btn" style="width:100%; margin-top:10px;">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            </div>
        </div>
    </div>

    <div id="stock-view" class="hidden">
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button onclick="showStockTab('raw')" class="action-btn tab-btn active">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (Raw)</button>
            <button onclick="showStockTab('sale')" class="action-btn tab-btn">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢ (Finished)</button>
        </div>

        <div id="tab-raw" class="stock-content">
            <div class="card">
                <h3>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤)</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto; gap: 5px; align-items:end;">
                    <div><label style="font-size:0.8em;">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label><input type="text" id="rawName"></div>
                    <div><label style="font-size:0.8em;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ñ‡∏∏‡∏á/‡πÅ‡∏û‡πá‡∏Ñ</label><input type="number" id="rawPricePack"></div>
                    <div><label style="font-size:0.8em;">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ï‡πà‡∏≠‡∏ñ‡∏∏‡∏á</label><input type="number" id="rawSize"></div>
                    <div><label style="font-size:0.8em;">‡∏´‡∏ô‡πà‡∏ß‡∏¢ (g/ml)</label><input type="text" id="rawUnit" value="‡∏Å‡∏£‡∏±‡∏°"></div>
                    <div><label style="font-size:0.8em;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ñ‡∏∏‡∏á</label><input type="number" id="rawQtyPack"></div>
                    <button onclick="addRawStock()" class="action-btn" style="margin-bottom:8px;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
                <p style="font-size:0.8em; color:#666;">* ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏£‡∏ß‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>

                <input type="text" id="searchRaw" onkeyup="renderRawStock()" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." style="margin-top:10px;">
                <table>
                    <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏ß‡∏°</th><th>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th style="text-align:center;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                    <tbody id="rawTable"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-sale" class="stock-content hidden">
            <div class="card">
                <h3>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡∏≤‡∏¢ (POS)</h3>
                <div id="adminProdForm" class="hidden" style="background:#FFF3E0; padding:15px; border-radius:10px; margin-bottom:15px;">
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px;">
                        <input type="text" id="prodName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π/‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                        <input type="number" id="prodPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢">
                        <input type="number" id="prodStock" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å">
                    </div>
                    <input type="text" id="prodImg" placeholder="Link ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Google Drive)">
                    <button onclick="addProduct()" class="action-btn" style="width:100%;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                </div>
                <div id="adminProdWarn" style="color:red; text-align:center;">* ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ *</div>

                <table>
                    <thead><tr><th>‡∏£‡∏π‡∏õ</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th style="text-align:center;">Admin</th></tr></thead>
                    <tbody id="prodTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="cost-view" class="hidden">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
            <div class="card">
                <h3 style="border-bottom:1px solid #eee; padding-bottom:10px;">üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°)</h3>
                <input type="text" id="recipeName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡πâ‡∏Å‡∏™‡πâ‡∏°)" style="font-weight:bold;">
                
                <div style="background:#F9F9F9; padding:10px; border-radius:8px; margin-top:10px;">
                    <label style="font-size:0.9em; font-weight:bold;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°:</label>
                    <div style="display:flex; gap:5px;">
                        <input type="text" id="ingName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°" style="flex:2;">
                        <input type="number" id="ingPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠" style="flex:1;">
                        <input type="number" id="ingPackSize" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ã‡∏∑‡πâ‡∏≠" style="flex:1;">
                    </div>
                    <div style="display:flex; gap:5px; align-items:center;">
                        <input type="number" id="ingUse" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ" style="flex:1;">
                        <input type="text" id="ingUnit" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢" style="flex:1;">
                        <button onclick="addIngredientToTable()" class="action-btn" style="flex:0.5;">+</button>
                    </div>
                </div>

                <table>
                    <thead><tr><th>‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°</th><th>‡πÉ‡∏ä‡πâ</th><th>‡∏ó‡∏∏‡∏ô</th><th>‡∏•‡∏ö</th></tr></thead>
                    <tbody id="recipeTable"></tbody>
                </table>
                
                <div style="margin-top:15px; text-align:right;">
                    <div>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: <b id="totalCostDisplay" style="font-size:1.2em; color:var(--red);">0.00</b></div>
                    <div style="margin-top:5px;">
                        ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢: <input type="number" id="sellingPrice" onkeyup="calcProfit()" style="width:100px; display:inline-block;">
                        ‡∏Å‡∏≥‡πÑ‡∏£: <span id="profitDisplay" style="font-weight:bold; color:var(--green);">0.00</span>
                    </div>
                    <button onclick="saveRecipe()" class="action-btn" style="width:100%; margin-top:15px;"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
                </div>
            </div>

            <div class="card">
                <h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
                <button onclick="loadCostHistory()" class="action-btn" style="background:var(--secondary); font-size:0.8em; margin-bottom:10px;">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <div id="costHistoryList" style="max-height:500px; overflow-y:auto;">Loading...</div>
            </div>
        </div>
    </div>
</div>

<div id="billModal" class="modal">
    <div class="modal-content">
        <div id="custForm" class="no-print" style="margin-bottom:15px; background:#f5f5f5; padding:10px; border-radius:5px;">
            <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏¥‡∏•‡πÄ‡∏ï‡πá‡∏°)</h4>
            <input type="text" id="cName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
            <input type="text" id="cAddr" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà">
            <input type="text" id="cTax" placeholder="‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ">
            <button onclick="updateBill()" class="action-btn" style="width:100%;">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡∏á‡∏ö‡∏¥‡∏•</button>
        </div>

        <div id="printableArea">
            <div class="bill-header">
                <img src="‡∏û‡∏±‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á.png" class="bill-logo" onerror="this.style.display='none'">
                <div id="shopInfoArea">
                    <b id="pShopName" style="font-size:1.1em;">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</b><br>
                    <span class="detailed-info" id="pShopAddr">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏£‡πâ‡∏≤‡∏ô...</span><br>
                    <span class="detailed-info" id="pShopPhone">‡πÇ‡∏ó‡∏£...</span>
                </div>
                <div class="bill-title" id="pDocTitle">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</div>
            </div>

            <div style="display:flex; justify-content:space-between; font-size:0.8em; margin-bottom:10px;">
                <div style="width:60%;">
                    <b>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</b> <span id="pCustName">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</span><br>
                    <span class="detailed-info" id="pCustDetails">
                        ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: <span id="pCustAddr">-</span><br>
                        ‡πÄ‡∏•‡∏Ç‡∏†‡∏≤‡∏©‡∏µ: <span id="pCustTax">-</span>
                    </span>
                </div>
                <div style="text-align:right;">
                    ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: <span id="pInvNo">INV-001</span><br>
                    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="pDate">01/01/2026</span>
                </div>
            </div>

            <table class="bill-table">
                <thead><tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏•‡∏∞</th><th>‡∏£‡∏ß‡∏°</th></tr></thead>
                <tbody id="pItems"></tbody>
            </table>

            <div style="text-align:right; margin-top:15px;">
                ‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: <b id="pTotal" style="font-size:1.2em;">0.00</b> ‡∏ö‡∏≤‡∏ó
            </div>
        </div>

        <div class="no-print" style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
            <button onclick="printBill()" class="action-btn"><i class="fas fa-print"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
            <button onclick="closeModal('billModal')" class="delete-btn">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
</div>

<div id="historyModal" class="modal">
    <div class="modal-content" style="max-width:600px;">
        <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (Admin)</h3>
        <div id="salesHistoryList" style="max-height:400px; overflow-y:auto;">Loading...</div>
        <button onclick="closeModal('historyModal')" class="delete-btn" style="margin-top:15px; width:100%;">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>

<div id="shopSetModal" class="modal">
    <div class="modal-content">
        <h3>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
        <input type="text" id="sName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô">
        <textarea id="sAddr" rows="3" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà"></textarea>
        <input type="text" id="sPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
        <button onclick="saveShopSet()" class="action-btn" style="width:100%;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button onclick="closeModal('shopSetModal')" class="delete-btn" style="width:100%; margin-top:5px;">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc, updateDoc, increment, getDoc, query, orderBy, Timestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCzi6OehJGWJwKoaFcYbdIfC7PZrK3er8c",
      authDomain: "pukklong-cost-a10b8.firebaseapp.com",
      projectId: "pukklong-cost-a10b8",
      storageBucket: "pukklong-cost-a10b8.firebasestorage.app",
      messagingSenderId: "274783658577",
      appId: "1:274783658577:web:929415a13be6b580b50e70"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const ADMIN_EMAIL = "pukklong.snackbox@gmail.com";

    let currentUser = null, isAdmin = false;
    let cart = [];
    let currentRecipe = [];
    let billType = 'simple';

    // --- Auth ---
    onAuthStateChanged(auth, (user) => {
        if (user) {
            currentUser = user; isAdmin = (user.email === ADMIN_EMAIL);
            document.getElementById('userImg').src = user.photoURL;
            document.getElementById('userName').innerText = user.displayName;
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('app-section').classList.remove('hidden');
            
            if(isAdmin) {
                document.getElementById('roleBadge').style.display = 'block';
                document.getElementById('btnShopSet').classList.remove('hidden');
                document.getElementById('btnSalesHistory').classList.remove('hidden');
                document.getElementById('adminProdForm').classList.remove('hidden');
                document.getElementById('adminProdWarn').classList.add('hidden');
            }
            fetchProducts();
            fetchRawStock();
            loadCostHistory();
        } else {
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('app-section').classList.add('hidden');
        }
    });

    window.loginWithGoogle = () => signInWithPopup(auth, provider);
    window.logout = () => signOut(auth).then(() => location.reload());
    window.goHome = () => {
        document.getElementById('dashboard-view').classList.remove('hidden');
        ['pos-view','stock-view','cost-view'].forEach(id=>document.getElementById(id).classList.add('hidden'));
    };
    window.openSystem = (sys) => {
        document.getElementById('dashboard-view').classList.add('hidden');
        if(sys==='pos') document.getElementById('pos-view').classList.remove('hidden');
        if(sys==='stock') document.getElementById('stock-view').classList.remove('hidden');
        if(sys==='cost') document.getElementById('cost-view').classList.remove('hidden');
    };
    window.closeModal = (id) => document.getElementById(id).style.display = 'none';

    // --- 1. POS System ---
    async function fetchProducts() {
        const q = query(collection(db, "products"));
        const snap = await getDocs(q);
        const grid = document.getElementById('posGrid');
        const table = document.getElementById('prodTable');
        grid.innerHTML = ''; table.innerHTML = '';
        
        snap.forEach(doc => {
            let p = doc.data();
            let id = doc.id;
            // POS Grid
            grid.innerHTML += `
                <div class="product-item" onclick="addToCart('${id}', '${p.name}', ${p.price}, ${p.stock})">
                    <div class="stock-badge">${p.stock}</div>
                    <img src="${p.img || 'https://via.placeholder.com/150'}" class="product-img">
                    <div class="product-info"><b>${p.name}</b><br>${p.price} ‡∏ö.</div>
                </div>`;
            // Admin Table
            table.innerHTML += `
                <tr>
                    <td><img src="${p.img}" style="width:30px;"></td>
                    <td>${p.name}</td><td>${p.price}</td><td>${p.stock}</td>
                    <td style="text-align:center;">
                        ${isAdmin ? `<button onclick="deleteProduct('${id}')" class="delete-btn">‡∏•‡∏ö</button>` : '-'}
                    </td>
                </tr>`;
        });
    }

    window.addToCart = (id, name, price, stock) => {
        if(stock <= 0) return alert('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å');
        let item = cart.find(x => x.id === id);
        if(item) {
            if(item.qty < stock) item.qty++;
        } else {
            cart.push({id, name, price, qty:1});
        }
        renderCart();
    };

    function renderCart() {
        let list = document.getElementById('cartList');
        let total = 0;
        list.innerHTML = '';
        cart.forEach((c, i) => {
            total += c.price * c.qty;
            list.innerHTML += `
                <div style="display:flex; justify-content:space-between; border-bottom:1px dashed #eee; padding:5px 0;">
                    <div>${c.name} x${c.qty}</div>
                    <div>${(c.price*c.qty).toFixed(2)} <span onclick="removeFromCart(${i})" style="color:red; cursor:pointer;">x</span></div>
                </div>`;
        });
        document.getElementById('cartTotal').innerText = total.toFixed(2);
    }
    window.removeFromCart = (i) => { cart.splice(i,1); renderCart(); };
    window.clearCart = () => { cart = []; renderCart(); };

    // --- Bill & Checkout ---
    window.checkout = async (type) => {
        if(cart.length === 0) return alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
        billType = type;
        const area = document.getElementById('printableArea');
        const form = document.getElementById('custForm');
        
        if(type === 'simple') {
            area.classList.add('simple-mode');
            form.style.display = 'none';
            document.getElementById('pDocTitle').innerText = "‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡πà‡∏≠)";
        } else {
            area.classList.remove('simple-mode');
            form.style.display = 'block';
            document.getElementById('pDocTitle').innerText = (type==='quote') ? "‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤" : "‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô/‡πÉ‡∏ö‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ";
        }
        
        // Load Shop Info
        const sSnap = await getDoc(doc(db, "settings", "shop_info"));
        const s = sSnap.exists() ? sSnap.data() : {name:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á", address:"-", phone:"-"};
        document.getElementById('pShopName').innerText = s.name;
        document.getElementById('pShopAddr').innerText = s.address;
        document.getElementById('pShopPhone').innerText = "‡πÇ‡∏ó‡∏£: " + s.phone;

        // Generate Info
        const d = new Date();
        document.getElementById('pDate').innerText = d.toLocaleString('th-TH');
        document.getElementById('pInvNo').innerText = "INV-" + Date.now().toString().slice(-6);
        
        window.updateBill();
        document.getElementById('billModal').style.display = 'block';
    };

    window.updateBill = () => {
        document.getElementById('pCustName').innerText = document.getElementById('cName').value || (billType==='simple' ? "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ" : "-");
        document.getElementById('pCustAddr').innerText = document.getElementById('cAddr').value || "-";
        document.getElementById('pCustTax').innerText = document.getElementById('cTax').value || "-";

        let tbody = document.getElementById('pItems');
        tbody.innerHTML = '';
        let total = 0;
        cart.forEach(c => {
            total += c.price * c.qty;
            tbody.innerHTML += `<tr><td>${c.name}</td><td>${c.qty}</td><td>${c.price.toFixed(2)}</td><td>${(c.price*c.qty).toFixed(2)}</td></tr>`;
        });
        document.getElementById('pTotal').innerText = total.toFixed(2);
    };

    window.printBill = async () => {
        window.print();
        if(billType !== 'quote') {
            // Save Sale
            try {
                await addDoc(collection(db, "sales"), {
                    date: Timestamp.now(),
                    items: cart,
                    total: parseFloat(document.getElementById('pTotal').innerText),
                    type: billType,
                    customer: billType==='simple' ? 'Cash' : document.getElementById('cName').value
                });
                // Cut Stock
                for(let item of cart) {
                    await updateDoc(doc(db, "products", item.id), { stock: increment(-item.qty) });
                }
                cart = []; renderCart(); fetchProducts();
                setTimeout(()=>document.getElementById('billModal').style.display='none', 1000);
            } catch(e) { alert("Error saving sale: "+e.message); }
        }
    };

    // --- POS History (Admin) ---
    window.openSalesHistory = async () => {
        if(!isAdmin) return;
        const q = query(collection(db, "sales"), orderBy("date", "desc"));
        const snap = await getDocs(q);
        let html = '<table style="font-size:0.8em;"><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏¢‡∏≠‡∏î</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>';
        snap.forEach(d => {
            let s = d.data();
            let date = s.date.toDate().toLocaleString('th-TH');
            html += `<tr>
                <td>${date}</td>
                <td>${s.customer}</td>
                <td>${s.total}</td>
                <td><button onclick="voidSale('${d.id}')" class="delete-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å(Void)</button></td>
            </tr>`;
        });
        html += '</table>';
        document.getElementById('salesHistoryList').innerHTML = html;
        document.getElementById('historyModal').style.display = 'block';
    };

    window.voidSale = async (id) => {
        if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏¥‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) return;
        // 1. Get Sale Data
        const saleRef = doc(db, "sales", id);
        const saleSnap = await getDoc(saleRef);
        if(!saleSnap.exists()) return;
        
        let items = saleSnap.data().items;
        // 2. Return Stock
        for(let item of items) {
            await updateDoc(doc(db, "products", item.id), { stock: increment(item.qty) });
        }
        // 3. Delete Bill
        await deleteDoc(saleRef);
        alert("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏¥‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        fetchProducts();
        window.openSalesHistory(); // Refresh
    };

    // --- 2. Stock System ---
    window.showStockTab = (t) => {
        document.querySelectorAll('.stock-content').forEach(c=>c.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById('tab-'+t).classList.remove('hidden');
        event.target.classList.add('active');
    };

    // Raw Material
    async function fetchRawStock() {
        const snap = await getDocs(collection(db, "raw_stock"));
        const tb = document.getElementById('rawTable');
        tb.innerHTML = '';
        window.rawItems = [];
        snap.forEach(d => {
            let r = d.data();
            window.rawItems.push(r);
            tb.innerHTML += `<tr>
                <td>${r.name}</td>
                <td>${parseFloat(r.totalQty).toFixed(2)} ${r.unit}</td>
                <td>${parseFloat(r.costPerUnit).toFixed(4)}</td>
                <td style="text-align:center;">${isAdmin ? `<button onclick="delRaw('${d.id}')" class="delete-btn">‡∏•‡∏ö</button>` : '-'}</td>
            </tr>`;
        });
    }

    window.addRawStock = async () => {
        let name = document.getElementById('rawName').value;
        let pricePack = parseFloat(document.getElementById('rawPricePack').value);
        let sizePack = parseFloat(document.getElementById('rawSize').value);
        let qtyPack = parseFloat(document.getElementById('rawQtyPack').value);
        let unit = document.getElementById('rawUnit').value;

        if(name && pricePack && sizePack && qtyPack) {
            let totalQty = sizePack * qtyPack;
            let totalPrice = pricePack * qtyPack;
            let costPerUnit = totalPrice / totalQty; // Weighted Avg logic can be more complex, this is simple add

            // Check existing
            // For simplicity in this request, we just add new or overwrite. 
            // In real app, we should query by name and avg the cost.
            await addDoc(collection(db, "raw_stock"), {
                name, totalQty, costPerUnit, unit
            });
            fetchRawStock();
            alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        }
    };
    window.renderRawStock = () => { /* Filter logic similar to previous */ };
    window.delRaw = async (id) => { if(confirm("‡∏•‡∏ö?")) { await deleteDoc(doc(db, "raw_stock", id)); fetchRawStock(); } };

    // Finished Goods
    window.addProduct = async () => {
        if(!isAdmin) return;
        let name = document.getElementById('prodName').value;
        let price = parseFloat(document.getElementById('prodPrice').value);
        let stock = parseFloat(document.getElementById('prodStock').value);
        let img = document.getElementById('prodImg').value;
        
        // Convert Google Drive Link
        if(img.includes('drive.google.com') && img.includes('/file/d/')) {
            let id = img.split('/file/d/')[1].split('/')[0];
            img = `https://drive.google.com/uc?export=view&id=${id}`;
        }

        if(name && price) {
            await addDoc(collection(db, "products"), { name, price, stock, img });
            fetchProducts();
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        }
    };
    window.deleteProduct = async (id) => { if(confirm("‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤?")) { await deleteDoc(doc(db, "products", id)); fetchProducts(); } };


    // --- 3. Cost Calculator (Standalone) ---
    window.addIngredientToTable = () => {
        let name = document.getElementById('ingName').value;
        let price = parseFloat(document.getElementById('ingPrice').value); // Price per pack
        let packSize = parseFloat(document.getElementById('ingPackSize').value); // Size of pack
        let use = parseFloat(document.getElementById('ingUse').value); // Amount used
        let unit = document.getElementById('ingUnit').value;

        if(name && price && packSize && use) {
            let cost = (price / packSize) * use;
            currentRecipe.push({ name, use, unit, cost });
            renderRecipeTable();
            // Clear inputs
            document.getElementById('ingName').value = '';
            document.getElementById('ingUse').value = '';
        }
    };

    function renderRecipeTable() {
        let tb = document.getElementById('recipeTable');
        tb.innerHTML = '';
        let total = 0;
        currentRecipe.forEach((r, i) => {
            total += r.cost;
            tb.innerHTML += `<tr>
                <td>${r.name}</td>
                <td>${r.use} ${r.unit}</td>
                <td>${r.cost.toFixed(2)}</td>
                <td><button onclick="removeIng(${i})" class="delete-btn">x</button></td>
            </tr>`;
        });
        document.getElementById('totalCostDisplay').innerText = total.toFixed(2);
        window.currentTotalCost = total;
        calcProfit();
    }
    window.removeIng = (i) => { currentRecipe.splice(i,1); renderRecipeTable(); };
    window.calcProfit = () => {
        let sell = parseFloat(document.getElementById('sellingPrice').value) || 0;
        let cost = window.currentTotalCost || 0;
        let profit = sell - cost;
        let disp = document.getElementById('profitDisplay');
        disp.innerText = profit.toFixed(2);
        disp.style.color = profit >= 0 ? 'var(--green)' : 'var(--red)';
    };

    window.saveRecipe = async () => {
        let name = document.getElementById('recipeName').value;
        if(!name || currentRecipe.length === 0) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏Å‡πà‡∏≠‡∏ô");
        
        await addDoc(collection(db, "cost_history"), {
            name: name,
            ingredients: currentRecipe,
            totalCost: window.currentTotalCost,
            sellingPrice: parseFloat(document.getElementById('sellingPrice').value) || 0,
            date: Timestamp.now()
        });
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        currentRecipe = []; renderRecipeTable();
        document.getElementById('recipeName').value = '';
        loadCostHistory();
    };

    window.loadCostHistory = async () => {
        const q = query(collection(db, "cost_history"), orderBy("date", "desc"));
        const snap = await getDocs(q);
        const div = document.getElementById('costHistoryList');
        div.innerHTML = '';
        snap.forEach(d => {
            let data = d.data();
            div.innerHTML += `
                <div style="border-bottom:1px solid #eee; padding:10px; font-size:0.9em;">
                    <div style="display:flex; justify-content:space-between;">
                        <b>${data.name}</b>
                        ${isAdmin ? `<button onclick="delHistory('${d.id}')" class="delete-btn">‡∏•‡∏ö</button>` : ''}
                    </div>
                    <div>‡∏ó‡∏∏‡∏ô: ${data.totalCost.toFixed(2)} | ‡∏Ç‡∏≤‡∏¢: ${data.sellingPrice} | ‡∏Å‡∏≥‡πÑ‡∏£: ${(data.sellingPrice - data.totalCost).toFixed(2)}</div>
                </div>`;
        });
    };
    window.delHistory = async (id) => { if(confirm("‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥?")) { await deleteDoc(doc(db, "cost_history", id)); loadCostHistory(); } };

    // --- Settings ---
    window.openShopSettings = async () => {
        const s = await getDoc(doc(db, "settings", "shop_info"));
        if(s.exists()) {
            let d = s.data();
            document.getElementById('sName').value = d.name;
            document.getElementById('sAddr').value = d.address;
            document.getElementById('sPhone').value = d.phone;
        }
        document.getElementById('shopSetModal').style.display = 'block';
    };
    window.saveShopSet = async () => {
        await setDoc(doc(db, "settings", "shop_info"), {
            name: document.getElementById('sName').value,
            address: document.getElementById('sAddr').value,
            phone: document.getElementById('sPhone').value
        });
        document.getElementById('shopSetModal').style.display = 'none';
    };

</script>
</body>
</html>
