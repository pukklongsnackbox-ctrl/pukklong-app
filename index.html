<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏û‡∏±‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #5D4037; --secondary: #8D6E63; --bg: #FDF5E6; --white: #ffffff; --accent: #A1887F; --yellow: #FFA000; --green-soft: #F1F8E9; }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #4E342E; }
        .container { max-width: 1200px; margin: 0 auto; }
        .hidden { display: none !important; }
        
        /* Auth & Layout */
        .auth-bar { background: rgba(255, 255, 255, 0.95); padding: 15px 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .user-img { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary); }
        .btn-logout { background: #FFCDD2; color: #C62828; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; }
        .action-btn { background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .edit-btn { background: #E3F2FD; color: #1976D2; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px; }
        .delete-btn { background: #FFEBEE; color: #C62828; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .void-btn { background: #607D8B; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        
        /* Inputs & Tables */
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 100%; box-sizing: border-box; margin-bottom: 5px; font-family: 'Sarabun'; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
        th { background: #eee; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #eee; }

        /* Dashboard Menu */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 40px; }
        .menu-card { background: white; padding: 40px; border-radius: 20px; text-align: center; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 2px solid transparent; }
        .menu-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .menu-card i { font-size: 4em; color: var(--primary); margin-bottom: 20px; }
        .menu-card h2 { margin: 0; color: #4E342E; }

        /* Tab System */
        .tab-menu { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 12px; background: #EFEBE9; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: var(--secondary); }
        .tab-btn.active { background: var(--primary); color: white; }

        /* POS Grid */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .product-item { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; position: relative; }
        .product-img { width: 100%; height: 120px; object-fit: cover; background: #ddd; }
        .product-info { padding: 10px; text-align: center; }
        .stock-tag { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; font-size: 0.7em; padding: 2px 6px; border-radius: 4px; }

        /* Search Bar */
        .search-container { margin-bottom: 15px; position: relative; }
        .search-container i { position: absolute; left: 15px; top: 13px; color: #999; }
        .search-container input { padding-left: 40px; border-radius: 25px; border: 2px solid #E0E0E0; }

        /* Bill Modal & Print */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow-y: auto; }
        .modal-content { background: white; margin: 2% auto; padding: 20px; width: 90%; max-width: 450px; border-radius: 10px; }
        
        @media print {
            body * { visibility: hidden; }
            #printableArea, #printableArea * { visibility: visible; }
            #printableArea { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; }
            .no-print { display: none !important; }
        }

        .bill-logo-center { display: block; margin: 0 auto 10px auto; width: 80px; height: auto; }
        .bill-table { width: 100%; font-size: 0.85em; margin-top: 10px; }
        .bill-table th, .bill-table td { border-bottom: 1px dotted #999; padding: 4px; }
        .bill-full-only { display: none; }
        .show-full .bill-full-only { display: block; }
        .show-full .bill-simple-only { display: none; }
        .bill-header { text-align: center; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="login-section" style="text-align:center; padding-top:100px;">
    <div style="background:white; padding:40px; border-radius:20px; display:inline-block; box-shadow:0 10px 30px rgba(0,0,0,0.1);">
        <h2 style="color:var(--primary);">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô ‡∏û‡∏±‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á</h2>
        <button onclick="loginWithGoogle()" class="action-btn" style="background:#4285F4; margin-top:20px;">
            <i class="fab fa-google"></i> Login Google
        </button>
    </div>
</div>

<div id="app-section" class="container hidden">
    <div class="auth-bar">
        <div style="display:flex; align-items:center; gap:10px;">
            <img id="userImg" class="user-img">
            <div>
                <b id="userName">User</b>
                <span id="roleBadge" style="background:red; color:white; font-size:0.7em; padding:2px 5px; border-radius:5px; display:none;">ADMIN</span>
            </div>
        </div>
        <div>
            <button onclick="goHome()" class="action-btn" style="background:#8D6E63;">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <button onclick="logout()" class="btn-logout">‡∏≠‡∏≠‡∏Å</button>
        </div>
    </div>

    <div id="dashboard-view">
        <div class="dashboard-grid">
            <div class="menu-card" onclick="openSystem('pos')">
                <i class="fas fa-store"></i>
                <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å & ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (POS)</h2>
                <p>‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•, ‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏à‡∏£‡∏¥‡∏á</p>
            </div>
            <div class="menu-card" onclick="openSystem('cost')">
                <i class="fas fa-calculator"></i>
                <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h2>
                <p>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏°‡∏ô‡∏π (‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≤‡∏¢)</p>
            </div>
        </div>
    </div>

    <div id="pos-view" class="hidden">
        <h2 style="color:var(--primary); border-bottom:2px solid var(--secondary);">‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô & ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
        
        <div class="tab-menu">
            <button class="tab-btn active" onclick="openPosTab('sales')">üõí ‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button class="tab-btn" id="btnStock" onclick="openPosTab('stock')">üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (Admin)</button>
            <button class="tab-btn" id="btnHistory" onclick="openPosTab('history')">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (Admin)</button>
        </div>

        <div id="pos-sales" class="pos-tab active">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="posSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π..." oninput="renderPos()">
            </div>
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                <div id="productGrid" class="product-grid">Loading...</div>
                
                <div style="background:white; padding:20px; border-radius:10px; height:fit-content; position: sticky; top: 20px;">
                    <h3>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <div id="cartItems" style="max-height: 300px; overflow-y: auto;"></div>
                    <div style="text-align:right; font-size:1.5em; font-weight:bold; margin:20px 0; color:var(--primary);">
                        ‡∏£‡∏ß‡∏°: <span id="cartTotal">0.00</span>
                    </div>
                    <h4 style="margin-bottom:5px;">‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•:</h4>
                    <div style="display:flex; gap:10px; flex-direction:column;">
                        <button onclick="checkout('simple')" class="action-btn" style="background:#4CAF50;">‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î (‡∏¢‡πà‡∏≠)</button>
                        <button onclick="checkout('full')" class="action-btn" style="background:#1976D2;">‡πÉ‡∏ö‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ (‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ)</button>
                        <button onclick="window.cart=[];renderCart();" class="delete-btn" style="width:100%; margin-top:5px;">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="pos-stock" class="pos-tab hidden">
            <div style="background:white; padding:20px; border-radius:10px; margin-bottom:20px;">
                <h3>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢ (Finished Goods)</h3>
                <div style="display:flex; gap:5px; margin-bottom:10px; background: #f9f9f9; padding: 15px; border-radius: 8px;">
                    <input type="text" id="prodName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π">
                    <input type="number" id="prodPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢">
                    <input type="number" id="prodStock" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å">
                    <input type="text" id="prodImg" placeholder="Link ‡∏£‡∏π‡∏õ (Google Drive)">
                    <button onclick="addProd()" class="action-btn" id="btnSaveProd">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="resetProdForm()" class="delete-btn" id="btnResetProd" style="display:none;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
                <table>
                    <thead><tr><th>‡∏£‡∏π‡∏õ</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                    <tbody id="prodTable"></tbody>
                </table>
            </div>

            <div style="background:white; padding:20px; border-radius:10px;">
                <h3>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (Raw Material Inventory)</h3>
                <div style="display:flex; gap:5px; margin-bottom:10px; background: #f9f9f9; padding: 15px; border-radius: 8px;">
                    <input type="hidden" id="invId">
                    <input type="text" id="invName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö">
                    <input type="text" id="invUnit" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ñ‡∏∏‡∏á, ‡∏Å‡∏Å.)">
                    <input type="number" id="invQty" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì">
                    <input type="number" id="invPrice" placeholder="‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢">
                    <button onclick="addInv()" class="action-btn" id="btnSaveInv">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="resetInvForm()" class="delete-btn" id="btnResetInv" style="display:none;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
                <table>
                    <thead><tr><th>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th><th>‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì</th><th>‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                    <tbody id="invTable"></tbody>
                </table>
            </div>
        </div>

        <div id="pos-history" class="pos-tab hidden">
            <div style="background:white; padding:20px; border-radius:10px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                    <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ & ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏¥‡∏•</h3>
                    <div style="background: var(--green-soft); padding: 10px 20px; border-radius: 10px; border: 1px solid #C8E6C9;">
                        ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏° (‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà): <b id="historySummary" style="color:#2E7D32; font-size: 1.2em;">0.00</b> ‡∏ö‡∏≤‡∏ó
                    </div>
                </div>
                <table>
                    <thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏¥‡∏•</th><th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                    <tbody id="saleHistoryTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="cost-view" class="hidden">
        <h2 style="color:var(--primary); border-bottom:2px solid var(--secondary);">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</h2>
        <div class="tab-menu">
            <button class="tab-btn active" onclick="openCalcTab('calc')">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç</button>
            <button class="tab-btn" onclick="openCalcTab('saved')">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>

        <div id="calc-main" class="calc-tab active">
            <div style="background:#FFF8E1; padding:20px; border-radius:10px; margin-bottom:20px; border:1px solid #FFE0B2;">
                <h3>1. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="cStockName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö">
                    <input type="number" id="cStockPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠">
                    <input type="number" id="cStockQty" placeholder="‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ã‡∏∑‡πâ‡∏≠">
                    <input type="text" id="cStockUnit" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏Å‡∏£‡∏±‡∏°/‡∏°‡∏•.)">
                    <button onclick="addCostStock()" class="action-btn">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
                <div style="margin-top:10px; max-height:150px; overflow-y:auto;">
                    <table id="cStockTable"></table>
                </div>
            </div>

            <div style="background:white; padding:20px; border-radius:10px; border:1px solid #ddd;">
                <h3>2. ‡∏ú‡∏™‡∏°‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏°‡∏ô‡∏π</h3>
                <div style="display:flex; gap:5px; align-items:flex-end;">
                    <div style="flex:2;">
                        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label>
                        <select id="cSelectIng"></select>
                    </div>
                    <div style="flex:1;">
                        <label>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</label>
                        <input type="number" id="cUseQty" placeholder="0">
                    </div>
                    <button onclick="addToRecipe()" class="action-btn" style="margin-bottom:5px;">+ ‡πÉ‡∏™‡πà‡∏´‡∏°‡πâ‡∏≠</button>
                </div>
                
                <table style="margin-top:15px;">
                    <thead><tr><th>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th><th>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</th><th>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</th><th>‡∏•‡∏ö</th></tr></thead>
                    <tbody id="recipeTable"></tbody>
                </table>

                <div style="background:#E0F2F1; padding:15px; margin-top:15px; text-align:right; border-radius:10px;">
                    <div>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: <b id="totalCost" style="font-size:1.5em; color:green;">0.00</b> ‡∏ö‡∏≤‡∏ó</div>
                    <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:10px;">
                        <input type="number" id="yieldQty" placeholder="‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏Å‡∏µ‡πà‡∏ä‡∏¥‡πâ‡∏ô?" style="width:120px;">
                        <input type="text" id="menuName" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π" style="width:200px;">
                        <button onclick="saveRecipe()" class="action-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="calc-saved" class="calc-tab hidden">
            <div style="background:white; padding:20px; border-radius:10px;">
                <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</h3>
                <div id="savedRecipeList"></div>
            </div>
        </div>
    </div>
</div>

<div id="billModal" class="modal">
    <div class="modal-content">
        <div id="printableArea">
            <img src="‡∏û‡∏±‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á.png" class="bill-logo-center" onerror="this.style.display='none'">
            <div class="bill-header">
                <b style="font-size:1.2em;">‡∏û‡∏±‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á</b><br>
                <div class="bill-full-only" style="font-size:0.8em;">
                    ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: 123/45 ‡∏ñ‡∏ô‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ï‡∏≥‡∏ö‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á<br>
                    ‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: 1234567890123<br>
                    ‡πÇ‡∏ó‡∏£: 081-234-5678
                </div>
                <h3 id="billTitle" style="margin:10px 0;">‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</h3>
            </div>
            <div class="bill-full-only" style="border-top:1px dashed #ccc; padding:5px 0; font-size:0.8em; margin-bottom:10px;">
                <b>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</b> <span id="billCustName"></span><br>
                <b>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> <span id="billCustAddr"></span><br>
                <b>‡πÄ‡∏•‡∏Ç‡∏†‡∏≤‡∏©‡∏µ:</b> <span id="billCustTax"></span>
            </div>
            <div style="font-size:0.8em; margin-bottom:5px;">
                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="billDate"></span> <span id="billTime"></span><br>
                ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: <span id="billNo"></span>
            </div>
            <table class="bill-table">
                <thead><tr><th align="left">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th align="right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th align="right">‡∏£‡∏≤‡∏Ñ‡∏≤</th><th align="right">‡∏£‡∏ß‡∏°</th></tr></thead>
                <tbody id="billItems"></tbody>
            </table>
            <div style="text-align:right; margin-top:15px; font-weight:bold; font-size:1.2em;">
                ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: <span id="billGrandTotal">0.00</span>
            </div>
        </div>
        <div id="customerInput" class="no-print" style="margin-top:15px; background:#f5f5f5; padding:10px; border-radius:5px; display:none;">
            <b>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</b>
            <input type="text" id="inCustName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó">
            <input type="text" id="inCustAddr" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà">
            <input type="text" id="inCustTax" placeholder="‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ">
        </div>
        <div class="no-print" style="margin-top:15px; text-align:center; display:flex; gap:10px; justify-content:center;">
            <button onclick="confirmPrint()" class="action-btn">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button onclick="closeModal()" class="delete-btn">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc, updateDoc, increment, query, orderBy, Timestamp, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCzi6OehJGWJwKoaFcYbdIfC7PZrK3er8c",
      authDomain: "pukklong-cost-a10b8.firebaseapp.com",
      projectId: "pukklong-cost-a10b8", 
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    const ADMIN_EMAIL = "pukklong.snackbox@gmail.com";

    let currentUser = null, isAdmin = false;
    window.products = []; window.cart = [];
    window.costStock = []; window.currentRecipe = [];

    window.loginWithGoogle = () => signInWithPopup(auth, provider);
    window.logout = () => signOut(auth).then(()=>location.reload());
    
    onAuthStateChanged(auth, async (user) => {
        if(user) {
            currentUser = user; isAdmin = (user.email === ADMIN_EMAIL);
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('app-section').classList.remove('hidden');
            document.getElementById('userImg').src = user.photoURL;
            document.getElementById('userName').innerText = user.displayName;
            if(isAdmin) {
                document.getElementById('roleBadge').style.display = 'inline-block';
                document.getElementById('btnStock').style.display = 'block';
                document.getElementById('btnHistory').style.display = 'block';
            }
            fetchProducts();
            fetchInventory();
            fetchCostStock();
        }
    });

    window.goHome = () => {
        document.getElementById('dashboard-view').classList.remove('hidden');
        document.getElementById('pos-view').classList.add('hidden');
        document.getElementById('cost-view').classList.add('hidden');
    };
    window.openSystem = (sys) => {
        document.getElementById('dashboard-view').classList.add('hidden');
        if(sys === 'pos') document.getElementById('pos-view').classList.remove('hidden');
        else document.getElementById('cost-view').classList.remove('hidden');
    };

    const convertDriveLink = (url) => {
        if(url && url.includes('drive.google.com') && url.includes('/file/d/')) {
            let id = url.split('/file/d/')[1].split('/')[0];
            return `https://drive.google.com/uc?export=view&id=${id}`;
        }
        return url || 'https://via.placeholder.com/150';
    };

    // --- Product Management (With Edit) ---
    async function fetchProducts() {
        const snap = await getDocs(collection(db, "products"));
        window.products = [];
        snap.forEach(d => window.products.push({id:d.id, ...d.data()}));
        renderPos(); renderProdTable();
    }
    window.addProd = async () => {
        if(!isAdmin) return;
        let n=document.getElementById('prodName').value, p=document.getElementById('prodPrice').value, s=document.getElementById('prodStock').value, i=document.getElementById('prodImg').value;
        if(n && p) {
            await setDoc(doc(db, "products", n), { name:n, price:Number(p), stock:Number(s), img:convertDriveLink(i) });
            resetProdForm();
            fetchProducts();
        }
    };
    window.editProd = (name) => {
        let p = window.products.find(x => x.name === name);
        if(p) {
            document.getElementById('prodName').value = p.name;
            document.getElementById('prodPrice').value = p.price;
            document.getElementById('prodStock').value = p.stock;
            document.getElementById('prodImg').value = p.img;
            document.getElementById('btnSaveProd').innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï";
            document.getElementById('btnResetProd').style.display = "inline-block";
            document.getElementById('prodName').readOnly = true;
        }
    };
    window.resetProdForm = () => {
        document.getElementById('prodName').value=''; document.getElementById('prodPrice').value='';
        document.getElementById('prodStock').value=''; document.getElementById('prodImg').value='';
        document.getElementById('btnSaveProd').innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å";
        document.getElementById('btnResetProd').style.display = "none";
        document.getElementById('prodName').readOnly = false;
    };
    window.renderProdTable = () => {
        let h = '';
        window.products.forEach(p => {
            h += `<tr>
                <td><img src="${p.img}" width="40" height="40" style="object-fit:cover; border-radius:5px;"></td>
                <td>${p.name}</td><td>${p.price}</td><td>${p.stock}</td>
                <td>
                    <button onclick="editProd('${p.name}')" class="edit-btn"><i class="fas fa-edit"></i></button>
                    <button onclick="delProd('${p.id}')" class="delete-btn"><i class="fas fa-trash"></i></button>
                </td></tr>`;
        });
        document.getElementById('prodTable').innerHTML = h;
    };
    window.delProd = async(id) => { if(confirm('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?')) { await deleteDoc(doc(db,"products",id)); fetchProducts(); }};

    // --- Inventory Management (With Edit) ---
    async function fetchInventory() {
        const snap = await getDocs(collection(db, "store_inventory"));
        let h = '';
        snap.forEach(d => {
            let data = d.data();
            h += `<tr><td>${data.name}</td><td>${data.qty} ${data.unit}</td><td>${data.price}</td>
                <td>
                    <button onclick="editInv('${d.id}')" class="edit-btn"><i class="fas fa-edit"></i></button>
                    <button onclick="delInv('${d.id}')" class="delete-btn"><i class="fas fa-trash"></i></button>
                </td></tr>`;
        });
        document.getElementById('invTable').innerHTML = h;
    }
    window.addInv = async () => {
        if(!isAdmin) return;
        let id=document.getElementById('invId').value, n=document.getElementById('invName').value, u=document.getElementById('invUnit').value, q=document.getElementById('invQty').value, p=document.getElementById('invPrice').value;
        if(n && q) {
            let data = { name:n, unit:u, qty:Number(q), price:Number(p) };
            if(id) await updateDoc(doc(db, "store_inventory", id), data);
            else await addDoc(collection(db, "store_inventory"), data);
            resetInvForm(); fetchInventory();
        }
    };
    window.editInv = async (id) => {
        const d = await getDoc(doc(db, "store_inventory", id));
        if(d.exists()) {
            let data = d.data();
            document.getElementById('invId').value = id;
            document.getElementById('invName').value = data.name;
            document.getElementById('invUnit').value = data.unit;
            document.getElementById('invQty').value = data.qty;
            document.getElementById('invPrice').value = data.price;
            document.getElementById('btnSaveInv').innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï";
            document.getElementById('btnResetInv').style.display = "inline-block";
        }
    };
    window.resetInvForm = () => {
        document.getElementById('invId').value=''; document.getElementById('invName').value='';
        document.getElementById('invUnit').value=''; document.getElementById('invQty').value=''; document.getElementById('invPrice').value='';
        document.getElementById('btnSaveInv').innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å";
        document.getElementById('btnResetInv').style.display = "none";
    };
    window.delInv = async(id) => { if(confirm('‡∏•‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ô‡∏µ‡πâ?')) { await deleteDoc(doc(db,"store_inventory",id)); fetchInventory(); }};

    // --- POS & Search ---
    window.renderPos = () => {
        let h = '';
        let filter = document.getElementById('posSearch').value.toLowerCase();
        window.products.forEach(p => {
            if(p.name.toLowerCase().includes(filter)) {
                let out = p.stock <= 0 ? 'opacity:0.5; pointer-events:none;' : '';
                h += `<div class="product-item" style="${out}" onclick="addToCart('${p.id}')">
                        <div class="stock-tag">${p.stock}</div>
                        <img src="${p.img}" class="product-img" onerror="this.src='https://via.placeholder.com/150'">
                        <div class="product-info"><b>${p.name}</b><br>${p.price} ‡∏ö.</div>
                      </div>`;
            }
        });
        document.getElementById('productGrid').innerHTML = h || '<p style="padding:20px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...</p>';
    };
    window.addToCart = (id) => {
        let p = window.products.find(x=>x.id==id);
        let exist = window.cart.find(x=>x.id==id);
        if(exist) { if(exist.qty < p.stock) exist.qty++; else alert('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠'); }
        else { window.cart.push({...p, qty:1}); }
        renderCart();
    };
    window.renderCart = () => {
        let h='', t=0;
        window.cart.forEach((c,i) => {
            t += c.price*c.qty;
            h += `<div style="display:flex; justify-content:space-between; margin-bottom:8px; padding-bottom:5px; border-bottom:1px dashed #eee;">
                    <div style="font-size:0.9em;">${c.name} <br> <small>${c.price} x ${c.qty}</small></div>
                    <div style="text-align:right;">${(c.price*c.qty).toFixed(2)} <br> <span onclick="window.cart.splice(${i},1);renderCart()" style="color:red; cursor:pointer; font-size:0.8em;">[‡∏•‡∏ö]</span></div>
                  </div>`;
        });
        document.getElementById('cartItems').innerHTML = h || '<center style="color:#999; padding:20px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</center>';
        document.getElementById('cartTotal').innerText = t.toLocaleString(undefined, {minimumFractionDigits: 2});
    };

    // --- Checkout ---
    let currentBillType = 'simple';
    window.checkout = (type) => {
        if(window.cart.length===0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
        currentBillType = type;
        let area = document.getElementById('printableArea');
        let custInput = document.getElementById('customerInput');
        
        if(type === 'full') {
            area.classList.add('show-full');
            document.getElementById('billTitle').innerText = "‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô / ‡πÉ‡∏ö‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏µ";
            custInput.style.display = 'block';
        } else {
            area.classList.remove('show-full');
            document.getElementById('billTitle').innerText = "‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î";
            custInput.style.display = 'none';
        }

        let h = '', t = 0;
        window.cart.forEach(c => {
            t += c.price*c.qty;
            h += `<tr><td>${c.name}</td><td align="right">${c.qty}</td><td align="right">${c.price.toFixed(2)}</td><td align="right">${(c.price*c.qty).toFixed(2)}</td></tr>`;
        });
        document.getElementById('billItems').innerHTML = h;
        document.getElementById('billGrandTotal').innerText = t.toLocaleString(undefined, {minimumFractionDigits: 2});
        
        let d = new Date();
        document.getElementById('billDate').innerText = d.toLocaleDateString('th-TH');
        document.getElementById('billTime').innerText = d.toLocaleTimeString('th-TH');
        document.getElementById('billNo').innerText = "INV-" + Date.now().toString().substr(-6);
        document.getElementById('billModal').style.display = 'block';
    };

    window.confirmPrint = async () => {
        if(currentBillType === 'full') {
            document.getElementById('billCustName').innerText = document.getElementById('inCustName').value || '-';
            document.getElementById('billCustAddr').innerText = document.getElementById('inCustAddr').value || '-';
            document.getElementById('billCustTax').innerText = document.getElementById('inCustTax').value || '-';
        }
        
        window.print();

        try {
            let total = parseFloat(document.getElementById('billGrandTotal').innerText.replace(/,/g, ''));
            let billNo = document.getElementById('billNo').innerText;
            
            await addDoc(collection(db, "sales"), {
                billNo: billNo,
                items: window.cart,
                total: total,
                date: Timestamp.now(),
                type: currentBillType,
                status: 'active'
            });

            for(let item of window.cart) {
                await updateDoc(doc(db, "products", item.id), { stock: increment(-item.qty) });
            }

            window.cart = []; renderCart(); fetchProducts();
            document.getElementById('billModal').style.display='none';
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        } catch(e) { alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + e.message); }
    };
    window.closeModal = () => document.getElementById('billModal').style.display='none';

    // --- History & Summary ---
    async function fetchSalesHistory() {
        const q = query(collection(db, "sales"), orderBy("date", "desc"));
        const snap = await getDocs(q);
        let h = '', totalSum = 0;
        snap.forEach(d => {
            let s = d.data();
            let date = s.date.toDate().toLocaleString('th-TH');
            if(s.status !== 'void') totalSum += s.total;
            
            let statusStyle = s.status === 'void' ? 'color:red; text-decoration:line-through;' : 'color:green;';
            let btn = (s.status !== 'void') ? `<button onclick="voidBill('${d.id}')" class="void-btn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>` : '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß';
            
            h += `<tr style="${s.status==='void'?'background:#f9f9f9':''}">
                    <td>${date}</td>
                    <td>${s.billNo}</td>
                    <td>${s.total.toLocaleString()}</td>
                    <td style="${statusStyle}">${s.status.toUpperCase()}</td>
                    <td>${btn}</td>
                  </tr>`;
        });
        document.getElementById('saleHistoryTable').innerHTML = h;
        document.getElementById('historySummary').innerText = totalSum.toLocaleString(undefined, {minimumFractionDigits: 2});
    }

    window.voidBill = async (id) => {
        if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏¥‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å?')) return;
        try {
            await updateDoc(doc(db, "sales", id), { status: 'void' });
            let snap = await getDoc(doc(db, "sales", id));
            let items = snap.data().items;
            for(let item of items) {
                await updateDoc(doc(db, "products", item.id), { stock: increment(item.qty) });
            }
            fetchSalesHistory(); fetchProducts();
        } catch(e) { alert(e.message); }
    };

    // --- Cost Calculator ---
    async function fetchCostStock() {
        const snap = await getDocs(collection(db, "global_cost_stock"));
        window.costStock = [];
        let h = '<tr><th>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏•‡∏ö</th></tr>';
        let sel = '<option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö--</option>';
        snap.forEach(d => {
            let dt = d.data();
            window.costStock.push({id:d.id, ...dt});
            h += `<tr><td>${dt.name}</td><td>${dt.price}/${dt.qty} ${dt.unit}</td><td><button onclick="delCostStock('${d.id}')" class="delete-btn">x</button></td></tr>`;
            sel += `<option value="${d.id}">${dt.name} (${(dt.price/dt.qty).toFixed(4)}/${dt.unit})</option>`;
        });
        document.getElementById('cStockTable').innerHTML = h;
        document.getElementById('cSelectIng').innerHTML = sel;
    }
    window.addCostStock = async () => {
        let n=document.getElementById('cStockName').value, p=document.getElementById('cStockPrice').value, q=document.getElementById('cStockQty').value, u=document.getElementById('cStockUnit').value;
        if(n && p && q) {
            await addDoc(collection(db, "global_cost_stock"), { name:n, price:Number(p), qty:Number(q), unit:u });
            fetchCostStock();
            document.getElementById('cStockName').value = '';
        }
    };
    window.delCostStock = async(id) => { if(confirm('‡∏•‡∏ö?')) { await deleteDoc(doc(db,"global_cost_stock",id)); fetchCostStock(); }};

    window.addToRecipe = () => {
        let id = document.getElementById('cSelectIng').value;
        let use = parseFloat(document.getElementById('cUseQty').value);
        if(id && use) {
            let item = window.costStock.find(x => x.id === id);
            let totalCost = (item.price / item.qty) * use;
            window.currentRecipe.push({ name: item.name, use: use, unit: item.unit, cost: totalCost });
            renderRecipe();
        }
    };
    window.renderRecipe = () => {
        let h = '', t = 0;
        window.currentRecipe.forEach((r,i) => {
            t += r.cost;
            h += `<tr><td>${r.name}</td><td>${r.use} ${r.unit}</td><td>${r.cost.toFixed(2)}</td><td><button onclick="window.currentRecipe.splice(${i},1);renderRecipe()" class="delete-btn">x</button></td></tr>`;
        });
        document.getElementById('recipeTable').innerHTML = h;
        document.getElementById('totalCost').innerText = t.toFixed(2);
    };

    window.saveRecipe = async () => {
        let name = document.getElementById('menuName').value;
        let yieldQty = document.getElementById('yieldQty').value;
        let total = parseFloat(document.getElementById('totalCost').innerText);
        if(name && window.currentRecipe.length > 0) {
            await addDoc(collection(db, "saved_recipes"), { name: name, ingredients: window.currentRecipe, totalCost: total, yield: yieldQty, date: Timestamp.now(), savedBy: currentUser.email });
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
            window.currentRecipe = []; renderRecipe();
            openCalcTab('saved');
        }
    };

    window.fetchSavedRecipes = async () => {
        const q = query(collection(db, "saved_recipes"), orderBy("date", "desc"));
        const snap = await getDocs(q);
        let h = '';
        snap.forEach(d => {
            let r = d.data();
            let costPerPcs = r.yield ? (r.totalCost / r.yield).toFixed(2) : '-';
            h += `<div style="background:#f9f9f9; padding:15px; margin-bottom:10px; border-radius:10px; border-left:5px solid var(--yellow); position:relative;">
                    <div style="display:flex; justify-content:space-between;">
                        <b style="font-size:1.1em; color:var(--primary);">${r.name}</b>
                        ${isAdmin ? `<button onclick="delRecipe('${d.id}')" class="delete-btn" style="padding:2px 8px;">‡∏•‡∏ö</button>` : ''}
                    </div>
                    <div style="font-size:0.9em; margin-top:5px;">‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°: ${r.totalCost.toFixed(2)} ‡∏ö. | ‡∏ï‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏•‡∏∞ ${costPerPcs} ‡∏ö. (${r.yield||'-'} ‡∏ä‡∏¥‡πâ‡∏ô)</div>
                  </div>`;
        });
        document.getElementById('savedRecipeList').innerHTML = h || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
    };
    window.delRecipe = async(id) => { if(confirm('‡∏•‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ?')) { await deleteDoc(doc(db,"saved_recipes",id)); fetchSavedRecipes(); }};

    window.openPosTab = (t) => {
        document.querySelectorAll('.pos-tab').forEach(x=>x.classList.add('hidden'));
        document.querySelectorAll('#pos-view .tab-btn').forEach(x=>x.classList.remove('active'));
        if(t=='sales') document.getElementById('pos-sales').classList.remove('hidden');
        if(t=='stock') document.getElementById('pos-stock').classList.remove('hidden');
        if(t=='history') { document.getElementById('pos-history').classList.remove('hidden'); fetchSalesHistory(); }
        event.target.classList.add('active');
    };
    window.openCalcTab = (t) => {
        document.querySelectorAll('.calc-tab').forEach(x=>x.classList.add('hidden'));
        document.querySelectorAll('#cost-view .tab-btn').forEach(x=>x.classList.remove('active'));
        if(t=='calc') document.getElementById('calc-main').classList.remove('hidden');
        if(t=='saved') { document.getElementById('calc-saved').classList.remove('hidden'); fetchSavedRecipes(); }
        event.target.classList.add('active');
    };
</script>
</body>
</html>
